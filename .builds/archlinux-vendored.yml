image: archlinux
packages:
    - python2
    - npm
    - gsfonts
    - mesa
    - libxrender
    - libxcomposite
sources:
    - https://github.com/kovidgoyal/calibre
tasks:
    - setup: |
        cd calibre
        # travis has literally "./node_modules/.bin"
        export PATH="$PWD/node_modules/.bin:$PATH"
        python2 setup/unix-ci.py install
        sed -ri "s@(/sw/sw|/tmp/t/[a-zA-Z0-9_-]+)@$PWD/../sw@g" ../sw/lib/pkgconfig/*.pc ../sw/qt/lib/*.prl
        python2 setup/unix-ci.py bootstrap --ephemeral
    - test: |
        cd calibre
        python2 setup/unix-ci.py test
